"use strict";var t=function(){function t(t,e){if(this._template="",this._prefixes=new Array,this._templateForHiddenInput="",this._prefixIndex=0,this.showPrefixOnFocus=!1,t){if("string"==typeof t){if(this._inputElement=document.getElementById(t),!this._inputElement)throw"There is no element with id: "+t}else{if("object"!=typeof t||"[object HTMLInputElement]"!=Object.prototype.toString.call(t))throw"Unknown input element type";this._inputElement=t}e.showPrefixOnFocus&&(this.showPrefixOnFocus=!0),e.createHiddenInput&&this._initHiddenInput(e.templateForHidden||""),this._initEvents()}if(!e.template)throw"Template must be specified";this.template=e.template,e.prefixes&&(this._prefixes=this._prefixes.concat(e.prefixes))}return Object.defineProperty(t.prototype,"templateChar",{get:function(){return"x"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"nonTemplateValueRegExp",{get:function(){return/\D/g},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"template",{get:function(){return this._template},set:function(t){if("string"!=typeof t)throw"Template must be a string";this._prefixes[0]=t.split(this.templateChar)[0],this._template=t.substring(t.indexOf(this.templateChar)),this._templateForHiddenInput=this._template},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentPrefix",{get:function(){return-1==this._prefixIndex?"":this._prefixes[this._prefixIndex]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"prefixes",{set:function(t){if(!Array.isArray(t)||0==t.length)throw"Prefixes must be a non empty Array!";if(!t.every((function(t){return"string"==typeof t})))throw"Possible prefix must be a string!";this._prefixes=[this._prefixes[0]].concat(t)},enumerable:!1,configurable:!0}),t.prototype._initEvents=function(){var t,e,i;null===(t=this._inputElement)||void 0===t||t.addEventListener("keyup",this.onKeyUp.bind(this)),null===(e=this._inputElement)||void 0===e||e.addEventListener("focus",this.onFocus.bind(this)),null===(i=this._inputElement)||void 0===i||i.addEventListener("blur",this.onBlur.bind(this))},t.prototype._initHiddenInput=function(t){this._inputElement&&this._clonedInput&&(this._clonedInput=this._inputElement.cloneNode(!0),this._inputElement.after(this._clonedInput),this._inputElement.setAttribute("name",""),this._clonedInput.style.display="none",this._clonedInput.setAttribute("id",""),this._templateForHiddenInput=t||this.template)},t.prototype.getUniqueMaxVal=function(t){for(var e=-1,i=-1,n=!0,r=0;r<t.length;r++)t[r]>e?(e=t[r],i=r,n=!0):e==t[r]&&(n=!1);return{value:e,index:n?i:-1}},t.prototype.calcPrefixMatchCount=function(t){var e=this,i=t.replace(this.nonTemplateValueRegExp,""),n=new Array;return this._prefixes.map((function(t){return t.replace(e.nonTemplateValueRegExp,"")})).forEach((function(t){for(var e=0,r=0;r<Math.min(t.length,i.length)&&t[r]==i[r];r++)e++;n.push(e)})),n},t.prototype.getSuitablePrefixIndex=function(t){if(!t||!t.trim())return-1;var e=this.getUniqueMaxVal(this.calcPrefixMatchCount(t));return 0===e.value?0:e.index},t.prototype._updatePossiblePrefix=function(t){(1!=this._prefixes.length||this._prefixes[0])&&(this._prefixIndex=this.getSuitablePrefixIndex(t),this._inputElement&&this._inputElement.dispatchEvent(new CustomEvent("tf.p.onchange",{bubbles:!0,detail:this._prefixIndex})))},t.prototype.pushPostfixIfNeeded=function(t){var e=this.template.lastIndexOf(this.templateChar);return this.currentPrefix.length+e+1==t.length?t+this.template.slice(e+1):t},t.prototype.removePrefix=function(t){for(var e=this.currentPrefix.replace(this.nonTemplateValueRegExp,""),i=0;t[i]&&e[i]===t[i];)i++;return i>=t.length?"":t.substring(i)},t.prototype.formatText=function(t){for(var e=this.removePrefix(t.replace(this.nonTemplateValueRegExp,"")),i="",n=0,r=0;n<this.template.length&&r<e.length;n++)i+=this.template[n]!=this.templateChar?this.template[n]:e[r++];return this.pushPostfixIfNeeded(this.currentPrefix+i)},t.prototype._getFirstTemplateMismatch=function(t){for(var e=this.getSuitablePrefixIndex(t),i=this._prefixes[e]+this.template,n=0;n<Math.min(t.length,i.length);n++)if(t[n]!==i[n]&&(i[n]!==this.templateChar||this.nonTemplateValueRegExp.test(t[n])))return n;return t.length!=i.length?Math.min(t.length,i.length):-1},t.prototype.isPartiallyMatchTemplate=function(t){if(t){var e=this._getFirstTemplateMismatch(t);return e>=t.length||-1==e}return!1},t.prototype.isMatchTemplate=function(t){return!!t&&-1==this._getFirstTemplateMismatch(t)},t.prototype.isInputValueValid=function(){if(this._inputElement)return this.isMatchTemplate(this._inputElement.value);throw"There is no input element"},t.prototype._processNewInput=function(t,e){return e&&this.isPartiallyMatchTemplate(t)?t:(this._updatePossiblePrefix(t),this.formatText(t))},t.prototype._processNewInputEvent=function(t){return this._processNewInput(t.target.value,8===t.keyCode||46===t.keyCode)},t.prototype.getRawValue=function(t){return t?t.replace(this.nonTemplateValueRegExp,""):""},t.prototype.onKeyUp=function(t){this._inputElement&&(this._inputElement.value=this._processNewInputEvent(t),this._clonedInput&&(this._clonedInput.value=this._inputElement.value.replace(this.nonTemplateValueRegExp,"")))},t.prototype.onFocus=function(t){this.showPrefixOnFocus&&this._processNewInput(this._prefixes[0]||"",!1)},t.prototype.onBlur=function(t){var e;this.currentPrefix==(null===(e=this._inputElement)||void 0===e?void 0:e.value)&&(this._inputElement.value="")},t}();module.exports=t;
