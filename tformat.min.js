"use strict";var TemplateFormatter=function(){function TemplateFormatter(inputElement,props){if(this._template="",this._prefixes=new Array,this._templateForHiddenInput="",this._prefixIndex=0,this.showPrefixOnFocus=!1,!props.template)throw"Template must be specified";if(this.template=props.template,inputElement){if("string"==typeof inputElement){if(this._inputElement=document.getElementById(inputElement),!this._inputElement)throw"There is no element with id: "+inputElement}else{if("object"!=typeof inputElement||"[object HTMLInputElement]"!=Object.prototype.toString.call(inputElement))throw"Unknown input element type";this._inputElement=inputElement}props.showPrefixOnFocus&&(props.prefixes&&this._prefixes.length+props.prefixes.length>1?console.warn("You've set showPrefixOnFocus, but there is more than one prefix"):this.showPrefixOnFocus=!0),props.createHiddenInput&&this._initHiddenInput(props.templateForHidden||""),this._initEvents(),this._inputElement.value&&this._updateValueInInput(this._processNewInput(this._inputElement.value,!1))}props.prefixes&&(this._prefixes=this._prefixes.concat(props.prefixes))}return Object.defineProperty(TemplateFormatter.prototype,"templateChar",{get:function(){return"x"},enumerable:!1,configurable:!0}),Object.defineProperty(TemplateFormatter.prototype,"nonTemplateValueRegExp",{get:function(){return/\D/g},enumerable:!1,configurable:!0}),Object.defineProperty(TemplateFormatter.prototype,"template",{get:function(){return this._template},set:function(newValue){if("string"!=typeof newValue)throw"Template must be a string";this._prefixes[0]=newValue.split(this.templateChar)[0],this._template=newValue.substring(newValue.indexOf(this.templateChar)),this._templateForHiddenInput=this._template},enumerable:!1,configurable:!0}),Object.defineProperty(TemplateFormatter.prototype,"currentPrefix",{get:function(){return-1==this._prefixIndex?"":this._prefixes[this._prefixIndex]},enumerable:!1,configurable:!0}),Object.defineProperty(TemplateFormatter.prototype,"prefixes",{set:function(newValue){if(!Array.isArray(newValue)||0==newValue.length)throw"Prefixes must be a non empty Array!";if(!newValue.every((function(t){return"string"==typeof t})))throw"Possible prefix must be a string!";this._prefixes=[this._prefixes[0]].concat(newValue)},enumerable:!1,configurable:!0}),TemplateFormatter.prototype._initEvents=function(){var _a,_b,_c;null===(_a=this._inputElement)||void 0===_a||_a.addEventListener("keyup",this.onKeyUp.bind(this)),null===(_b=this._inputElement)||void 0===_b||_b.addEventListener("focus",this.onFocus.bind(this)),null===(_c=this._inputElement)||void 0===_c||_c.addEventListener("blur",this.onBlur.bind(this))},TemplateFormatter.prototype._initHiddenInput=function(templateForHidden){this._inputElement&&(this._clonedInput=this._inputElement.cloneNode(!0),this._inputElement.after(this._clonedInput),this._inputElement.setAttribute("name",""),this._clonedInput.style.display="none",this._clonedInput.setAttribute("id",""),this._templateForHiddenInput=templateForHidden||this.template)},TemplateFormatter.prototype.getUniqueMaxVal=function(arr){for(var maxVal=-1,maxIndx=-1,isValUnique=!0,i=0;i<arr.length;i++)arr[i]>maxVal?(maxVal=arr[i],maxIndx=i,isValUnique=!0):maxVal==arr[i]&&(isValUnique=!1);return{value:maxVal,index:isValUnique?maxIndx:-1}},TemplateFormatter.prototype.calcPrefixMatchCount=function(textToMatch){var _this=this,clearedText=textToMatch.replace(this.nonTemplateValueRegExp,""),matchCount=new Array;return this._prefixes.map((function(t){return t.replace(_this.nonTemplateValueRegExp,"")})).forEach((function(v){for(var matches=0,i=0;i<Math.min(v.length,clearedText.length)&&v[i]==clearedText[i];i++)matches++;matchCount.push(matches)})),matchCount},TemplateFormatter.prototype.getSuitablePrefixIndex=function(text){if(!text||!text.trim())return-1;var uniqueVal=this.getUniqueMaxVal(this.calcPrefixMatchCount(text));return 0===uniqueVal.value?0:uniqueVal.index},TemplateFormatter.prototype._updatePossiblePrefix=function(newEnteredText){(1!=this._prefixes.length||this._prefixes[0])&&(this._prefixIndex=this.getSuitablePrefixIndex(newEnteredText),this._inputElement&&this._inputElement.dispatchEvent(new CustomEvent("tf.p.onchange",{bubbles:!0,detail:this._prefixIndex})))},TemplateFormatter.prototype.pushPostfixIfNeeded=function(text){var startOfPostfix=this.template.lastIndexOf(this.templateChar);return this.currentPrefix.length+startOfPostfix+1==text.length?text+this.template.slice(startOfPostfix+1):text},TemplateFormatter.prototype.removePrefix=function(textWithPrefix){for(var currentPrefix=this.currentPrefix.replace(this.nonTemplateValueRegExp,""),prefixEnd=0;textWithPrefix[prefixEnd]&&currentPrefix[prefixEnd]===textWithPrefix[prefixEnd];)prefixEnd++;return prefixEnd>=textWithPrefix.length?"":textWithPrefix.substring(prefixEnd)},TemplateFormatter.prototype.formatText=function(textToFormat){for(var textWithTemplateVals=this.removePrefix(textToFormat.replace(this.nonTemplateValueRegExp,"")),formattedText="",templateIndex=0,textIndex=0;templateIndex<this.template.length&&textIndex<textWithTemplateVals.length;templateIndex++)formattedText+=this.template[templateIndex]!=this.templateChar?this.template[templateIndex]:textWithTemplateVals[textIndex++];return this.pushPostfixIfNeeded(this.currentPrefix+formattedText)},TemplateFormatter.prototype._getFirstTemplateMismatch=function(text){for(var prefixIndx=this.getSuitablePrefixIndex(text),fullTemplate=this._prefixes[prefixIndx]+this.template,i=0;i<Math.min(text.length,fullTemplate.length);i++)if(text[i]!==fullTemplate[i]&&(fullTemplate[i]!==this.templateChar||this.nonTemplateValueRegExp.test(text[i])))return i;return text.length!=fullTemplate.length?Math.min(text.length,fullTemplate.length):-1},TemplateFormatter.prototype.isPartiallyMatchTemplate=function(text){if(text){var firstMismatch=this._getFirstTemplateMismatch(text);return firstMismatch>=text.length||-1==firstMismatch}return!1},TemplateFormatter.prototype.isMatchTemplate=function(text){return!!text&&-1==this._getFirstTemplateMismatch(text)},TemplateFormatter.prototype.isInputValueValid=function(){if(this._inputElement)return this.isMatchTemplate(this._inputElement.value);throw"There is no input element"},TemplateFormatter.prototype._processNewInput=function(newInputText,wasCharDeleted){return wasCharDeleted&&this.isPartiallyMatchTemplate(newInputText)?newInputText:(this._updatePossiblePrefix(newInputText),this.formatText(newInputText))},TemplateFormatter.prototype._processNewInputEvent=function(event){return this._processNewInput(event.target.value,8===event.keyCode||46===event.keyCode)},TemplateFormatter.prototype.getRawValue=function(formattedText){return formattedText?formattedText.replace(this.nonTemplateValueRegExp,""):""},TemplateFormatter.prototype._updateValueInInput=function(newValue){this._inputElement&&(this._inputElement.value=newValue,this._clonedInput&&(this._clonedInput.value=this._inputElement.value.replace(this.nonTemplateValueRegExp,"")))},TemplateFormatter.prototype.onKeyUp=function(event){this._updateValueInInput(this._processNewInputEvent(event))},TemplateFormatter.prototype.onFocus=function(event){this.showPrefixOnFocus&&this._inputElement&&""==this._inputElement.value&&(this._inputElement.value=this._processNewInput(this._prefixes[0]||"",!1))},TemplateFormatter.prototype.onBlur=function(event){var _a;this.currentPrefix==(null===(_a=this._inputElement)||void 0===_a?void 0:_a.value)&&(this._inputElement.value="")},TemplateFormatter}();
