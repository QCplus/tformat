"use strict";var TemplateFormatter=function(){function TemplateFormatter(inputElement,props){if(this._template="",this._prefixIndex=0,this._prefixes=new Array,this.showPrefixOnFocus=!1,this.hidePrefixOnBlur=!0,this.showTemplateOnFocus=!1,this.emptySpaceChar=" ",!props.template)throw"Template must be specified";if(this.template=props.template,inputElement){if("string"==typeof inputElement){if(this._inputElement=document.getElementById(inputElement),!this._inputElement)throw"There is no element with id: "+inputElement}else{if("object"!=typeof inputElement||"[object HTMLInputElement]"!=Object.prototype.toString.call(inputElement))throw"Unknown input element type";this._inputElement=inputElement}props.showPrefixOnFocus&&(props.prefixes&&this._prefixes.length+props.prefixes.length>1?console.warn("You've set showPrefixOnFocus, but there is more than one prefix"):this.showPrefixOnFocus=!0),props.createHiddenInput&&this._initHiddenInput(),this._initEvents(),this._inputElement.value&&this._updateInputValue(this._processNewInput(this._inputElement.value,!1),!1)}props.prefixes&&(this._prefixes=this._prefixes.concat(props.prefixes)),void 0!==props.hidePrefixOnBlur&&(this.hidePrefixOnBlur=!!props.hidePrefixOnBlur),this.showTemplateOnFocus=!!props.showFullTemplate,props.emptySpaceChar&&(this.templateValueRegExp.test(props.emptySpaceChar)?console.error("emptySpaceChar can't be a number!"):this.emptySpaceChar=props.emptySpaceChar[0])}return Object.defineProperty(TemplateFormatter.prototype,"templateChar",{get:function(){return"x"},enumerable:!1,configurable:!0}),Object.defineProperty(TemplateFormatter.prototype,"nonTemplateValueRegExp",{get:function(){return/\D/g},enumerable:!1,configurable:!0}),Object.defineProperty(TemplateFormatter.prototype,"templateValueRegExp",{get:function(){return/\d/g},enumerable:!1,configurable:!0}),Object.defineProperty(TemplateFormatter.prototype,"template",{get:function(){return this._template},set:function(newValue){if("string"!=typeof newValue)throw"Template must be a string";this._prefixes[0]=newValue.split(this.templateChar)[0],this._template=newValue.substring(newValue.indexOf(this.templateChar))},enumerable:!1,configurable:!0}),Object.defineProperty(TemplateFormatter.prototype,"currentPrefix",{get:function(){return-1==this._prefixIndex?"":this._prefixes[this._prefixIndex]},enumerable:!1,configurable:!0}),Object.defineProperty(TemplateFormatter.prototype,"prefixes",{set:function(newValue){if(!Array.isArray(newValue)||0==newValue.length)throw"Prefixes must be a non empty Array!";if(!newValue.every((function(t){return"string"==typeof t})))throw"Possible prefix must be a string!";this._prefixes=[this._prefixes[0]].concat(newValue)},enumerable:!1,configurable:!0}),TemplateFormatter.prototype._initEvents=function(){var _a,_b,_c;null===(_a=this._inputElement)||void 0===_a||_a.addEventListener("input",this.onInput.bind(this)),null===(_b=this._inputElement)||void 0===_b||_b.addEventListener("focus",this.onFocus.bind(this)),null===(_c=this._inputElement)||void 0===_c||_c.addEventListener("blur",this.onBlur.bind(this))},TemplateFormatter.prototype._initHiddenInput=function(){this._inputElement&&(this._clonedInput=this._inputElement.cloneNode(!0),this._inputElement.after(this._clonedInput),this._inputElement.setAttribute("name",""),this._clonedInput.style.display="none",this._clonedInput.setAttribute("id",""))},TemplateFormatter.prototype.getUniqueMaxVal=function(arr){for(var maxVal=-1,maxIndx=-1,isValUnique=!0,i=0;i<arr.length;i++)arr[i]>maxVal?(maxVal=arr[i],maxIndx=i,isValUnique=!0):maxVal==arr[i]&&(isValUnique=!1);return{value:maxVal,index:isValUnique?maxIndx:-1}},TemplateFormatter.prototype.calcPrefixMatchCount=function(textToMatch){var _this=this,clearedText=textToMatch.replace(this.nonTemplateValueRegExp,""),matchCount=new Array;return this._prefixes.map((function(t){return t.replace(_this.nonTemplateValueRegExp,"")})).forEach((function(v){for(var matches=0,i=0;i<Math.min(v.length,clearedText.length)&&v[i]==clearedText[i];i++)matches++;matchCount.push(matches)})),matchCount},TemplateFormatter.prototype.getSuitablePrefixIndex=function(text){if(!text||!text.trim())return this._prefixes.length>0?0:-1;var uniqueVal=this.getUniqueMaxVal(this.calcPrefixMatchCount(text));return 0===uniqueVal.value?0:uniqueVal.index},TemplateFormatter.prototype._updatePossiblePrefix=function(newEnteredText){(1!=this._prefixes.length||this._prefixes[0])&&(this._prefixIndex=this.getSuitablePrefixIndex(newEnteredText),this._inputElement&&this._inputElement.dispatchEvent(new CustomEvent("tf.p.onchange",{bubbles:!0,detail:this._prefixIndex})))},TemplateFormatter.prototype.pushPostfixIfNeeded=function(text){var startOfPostfix=this.template.lastIndexOf(this.templateChar);return this.currentPrefix.length+startOfPostfix+1==text.length?text+this.template.slice(startOfPostfix+1):text},TemplateFormatter.prototype.removePrefixFormatted=function(formattedText){var currentPrefix=this.currentPrefix;return currentPrefix?formattedText.substring(0==formattedText.indexOf(currentPrefix)?currentPrefix.length:0):formattedText},TemplateFormatter.prototype.removePrefix=function(text){for(var textWithPrefix=this.removeNonTemplateVals(text),currentPrefix=this.currentPrefix.replace(this.nonTemplateValueRegExp,""),prefixEnd=0;textWithPrefix[prefixEnd]&&currentPrefix[prefixEnd]===textWithPrefix[prefixEnd];)prefixEnd++;return prefixEnd>=textWithPrefix.length?"":textWithPrefix.substring(prefixEnd)},TemplateFormatter.prototype.removeNonTemplateVals=function(text){return text.replace(this.nonTemplateValueRegExp,"")},TemplateFormatter.prototype._fillTemplateWithTextVals=function(text){var _this=this,textWithTemplateVals=this.removePrefix(text),textIndex=0,formattedText="";return Array.from(this.template).some((function(currentTemplateChar){if(currentTemplateChar==_this.templateChar)if(textIndex<textWithTemplateVals.length)formattedText+=textWithTemplateVals[textIndex++];else{if(!_this.showTemplateOnFocus)return!0;formattedText+=_this.emptySpaceChar}else formattedText+=currentTemplateChar})),formattedText},TemplateFormatter.prototype.formatText=function(textToFormat){var formattedText=this._fillTemplateWithTextVals(textToFormat);return this.pushPostfixIfNeeded(this.currentPrefix+formattedText)},TemplateFormatter.prototype._getTemplateMismatchIndex=function(text){for(var prefixIndx=this.getSuitablePrefixIndex(text),fullTemplate=this._prefixes[prefixIndx]+this.template,i=0;i<Math.min(text.length,fullTemplate.length);i++)if(text[i]!==fullTemplate[i]&&(fullTemplate[i]!==this.templateChar||this.nonTemplateValueRegExp.test(text[i])))return i;return text.length!=fullTemplate.length?Math.min(text.length,fullTemplate.length):-1},TemplateFormatter.prototype.isPartiallyMatchTemplate=function(text){if(text){var firstMismatch=this._getTemplateMismatchIndex(text);return firstMismatch>=text.length||-1==firstMismatch}return!1},TemplateFormatter.prototype.isMatchTemplate=function(text){return!!text&&-1==this._getTemplateMismatchIndex(text)},TemplateFormatter.prototype.isInputValueValid=function(){if(this._inputElement)return this.isMatchTemplate(this._inputElement.value);throw"There is no input element"},TemplateFormatter.prototype._processNewInput=function(newInputText,wasCharDeleted){if(this._updatePossiblePrefix(newInputText),wasCharDeleted){var textWithTemplateVals=newInputText.replace(this.nonTemplateValueRegExp,"");if(!textWithTemplateVals||textWithTemplateVals==this.currentPrefix.replace(this.nonTemplateValueRegExp,""))return"";if(!this.showTemplateOnFocus&&this.isPartiallyMatchTemplate(newInputText))return newInputText}return this.formatText(newInputText)},TemplateFormatter.prototype.getRawValue=function(formattedText){return formattedText?formattedText.replace(this.nonTemplateValueRegExp,""):""},TemplateFormatter.prototype._findNextTemplateVal=function(text,startIndex){for(var i=startIndex+1;i<text.length;i++)if(this.templateValueRegExp.test(text[i]))return i;return-1},TemplateFormatter.prototype._getInputCaretPosition=function(currCaretPosition,inputValue,wasCharDeleted){if(!wasCharDeleted){var noPrefixValueLen=this.removeNonTemplateVals(this.removePrefixFormatted(inputValue)).length;if(noPrefixValueLen<=1)return this.currentPrefix.length+noPrefixValueLen;if(currCaretPosition>0&&!this.templateValueRegExp.test(inputValue[currCaretPosition-1])&&this.removeNonTemplateVals(inputValue.substring(currCaretPosition-1)).length>0){var nextTemplateValIndex=this._findNextTemplateVal(inputValue,currCaretPosition-1);return-1==nextTemplateValIndex?currCaretPosition:nextTemplateValIndex+1}}return currCaretPosition},TemplateFormatter.prototype._updateInputValue=function(newValue,wasCharDeleted){if(this._inputElement){var caretPosition=this._inputElement.selectionStart||0;this._inputElement.value=newValue;var newCaretPosition=this._getInputCaretPosition(caretPosition,newValue,wasCharDeleted);this._inputElement.setSelectionRange(newCaretPosition,newCaretPosition),this._clonedInput&&(this._clonedInput.value=this._inputElement.value.replace(this.nonTemplateValueRegExp,""))}},TemplateFormatter.prototype.onInput=function(event){var inputEvent,wasCharDeleted=event.inputType.startsWith("delete");this._updateInputValue(this._processNewInput(event.target.value,wasCharDeleted),wasCharDeleted)},TemplateFormatter.prototype.onFocus=function(event){this.showPrefixOnFocus&&this._inputElement&&""==this._inputElement.value&&(this._inputElement.value=this._processNewInput(this._prefixes[0]||"",!1))},TemplateFormatter.prototype.onBlur=function(event){var _a;this.hidePrefixOnBlur&&this.currentPrefix==(null===(_a=this._inputElement)||void 0===_a?void 0:_a.value)&&(this._inputElement.value="")},TemplateFormatter}();
